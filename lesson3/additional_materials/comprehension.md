## comprehension


List comprehension, dictionary comprehension и другие comprehension в Python являются способом создания новых последовательностей (списков, словарей и т.д.) на основе уже существующих.

### list comprehension
Синтаксис list comprehension имеет следующий вид:

```python
new_list = [expression for item in iterable if condition]
```

где `expression` - выражение, которое применяется к каждому элементу `item` из итерируемого объекта `iterable`. Если задано условие `condition`, то оно должно выполняться для каждого элемента `item`. Результаты вычислений записываются в новый список `new_list`.

Пример:

```python
old_list = [1, 2, 3, 4, 5]
new_list = [x * x for x in old_list if x % 2 == 0]
```

В этом примере создается новый список `new_list`, который содержит квадраты четных чисел из списка `old_list`. Таким образом, новый список будет содержать `[4, 16]`.

Аналогичным образом можно использовать dictionary comprehension для создания словаря на основе существующего итерируемого объекта.


### dictionary comprehension

Синтаксис dictionary comprehension имеет следующий вид:

```python
new_dict = {key_expression: value_expression for item in iterable if condition}
```

где `key_expression` и `value_expression` - выражения, которые применяются к каждому элементу `item` из итерируемого объекта `iterable`. Если задано условие `condition`, то оно должно выполняться для каждого элемента `item`. Результаты вычислений записываются в новый словарь `new_dict`.

Пример:

```python
old_dict = {'a': 1, 'b': 2, 'c': 3, 'd': 4, 'e': 5}
new_dict = {k: v * v for k, v in old_dict.items() if v % 2 == 0}
```

В этом примере создается новый словарь `new_dict`, который содержит квадраты значений с четными ключами из словаря `old_dict`. Таким образом, новый словарь будет содержать `{'b': 4, 'd': 16}`.

Вложенные comprehension позволяют создавать последовательности, которые являются результатом нескольких итераций или условий.

Пример вложенного list comprehension:

```python
matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
flat_list = [x for row in matrix for x in row]
```

В этом примере создается новый список `flat_list`, который содержит все элементы матрицы, выравненные в одномерный список. Таким образом, новый список будет содержать `[1, 2, 3, 4, 5, 6, 7, 8, 9]`.

Пример вложенного dictionary comprehension:

```python
dict_of_lists = {i: [i, i * 2, i * 3] for i in range(1, 4)}
```

В этом примере создается новый словарь `dict_of_lists`, который содержит списки, созданные на основе целых чисел от 1 до 3. Ключи словаря соответствуют этим целым числам, а значения представлены списками, содержащими их умноженные на 1, 2 и 3. Таким образом, новый словарь будет содержать `{1: [1, 2, 3], 2: [2, 4, 6], 3: [3, 6, 9]}`.

Comprehension в Python представляют собой простой и элегантный способ создания новых последовательностей на основе уже существующих, а также предоставляют возможность улучшить читабельность и компактность кода.

### generator expressions
Генераторные выражения (generator expressions) являются аналогами comprehension, но вместо создания новой последовательности, они создают генератор, который по запросу генерирует новые элементы. Они имеют такой же синтаксис, как и comprehension, но заключены в круглые скобки вместо квадратных или фигурных скобок. Например, вот как можно создать генератор, который выдаст первые пять чисел Фибоначчи:

```python
fib = (lambda n: fib(n-1) + fib(n-2) if n > 1 else n for i in range(5))
```

В этом примере мы используем lambda-функцию, которая определяет рекурсивное правило для вычисления чисел Фибоначчи. Затем мы создаем генераторное выражение, которое вызывает эту функцию для каждого значения `i` в диапазоне от 0 до 4.


### set comprehension
Множественные выражения (set comprehension) похожи на список и словарь comprehension, но создают множество, а не список или словарь. Они имеют такой же синтаксис, как и список и словарь comprehension, но заключены в фигурные скобки. Например, вот как можно создать множество, содержащее квадраты чисел от 1 до 10:

```python
squares = {x**2 for x in range(1, 11)}
```

Здесь мы используем множественное выражение для создания множества, содержащего квадраты чисел от 1 до 10. В результате, мы получим множество `{1, 4, 9, 16, 25, 36, 49, 64, 81, 100}`.


### Сложная структура comprehension

Конечная структура, созданная объединением листа и словаря comprehension, может иметь любую форму в зависимости от конкретной задачи. Однако, общий подход для создания сложной структуры может быть следующим:

```python
# Запись в одну строку
result = {key_expr: {value_expr for value in values} for key, values in dict.items()}

# Запись с переносом для удобства чтения
result = {
    key_expr: {
        value_expr for value in values
    } for key, values in dict.items()
}

```

Здесь `key_expr` - это выражение, которое вычисляется для каждого ключа `key` в словаре `dict`, чтобы получить ключ для соответствующего значения. `value_expr` - это выражение, которое вычисляется для каждого элемента `value` в списке `values`, чтобы получить значение в новом словаре.

Например, рассмотрим пример, где нужно создать словарь, в котором ключами будут имена цветов, а значениями - списки из названий фруктов этого цвета:

```python
fruits = {
    'apple': 'red',
    'banana': 'yellow',
    'grape': 'purple',
    'orange': 'orange',
    'kiwi': 'green',
    'blueberry': 'blue'
}

result = {
    color: [
        fruit
        for fruit, fruit_color in fruits.items()
        if fruit_color == color
    ] for color in set(fruits.values())
}
```

В этом примере мы создаем словарь `result`, используя словарь comprehension, в котором ключами являются уникальные цвета фруктов, а значениями - списки фруктов этого цвета. Мы используем множество `set(fruits.values())`, чтобы получить список уникальных цветов, затем используем лист comprehension, чтобы создать списки фруктов каждого цвета.
